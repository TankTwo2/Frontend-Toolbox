(()=>{"use strict";function e(e){if("svg"===e.type)return`${e.alt||"svg-image"}.svg`;if(e.src&&e.src.startsWith("blob:"))return`${e.alt||"image"}.${"background"===e.type?"jpg":"png"}`;try{let t=new URL(e.src||e.url).pathname.split("/").pop()||"image";if(!t.includes(".")){let o=function(e){if(!e)return null;const t=e.match(/\.(jpg|jpeg|png|gif|svg|webp|bmp)(\?|$)/i);return t?t[1].toLowerCase():null}(e.src||e.url);return o||(o="background"===e.type?"jpg":"png"),`${t}.${o}`}return t}catch{return`${e.alt||"image"}.${"background"===e.type?"jpg":"png"}`}}function t(e){const{properties:t,selector:o}=e;let r=`${o} {\n`;const a=["display","position","width","height","color","background-color","font-size","font-family"];return a.forEach(e=>{Object.entries(t).forEach(([t,o])=>{o[e]&&(r+=`  ${e}: ${o[e]};\n`)})}),Object.entries(t).forEach(([e,t])=>{Object.entries(t).forEach(([e,t])=>{!a.includes(e)&&t&&"initial"!==t&&"normal"!==t&&(r+=`  ${e}: ${t};\n`)})}),r+="}",r}function o(e){const{properties:t,tailwindClasses:o}=e,r=[...o||[]],a={display:e=>({block:"block",inline:"inline","inline-block":"inline-block",flex:"flex","inline-flex":"inline-flex",grid:"grid",hidden:"hidden"}[e]||null),"text-align":e=>({left:"text-left",center:"text-center",right:"text-right",justify:"text-justify"}[e]||null),"font-weight":e=>({100:"font-thin",200:"font-extralight",300:"font-light",400:"font-normal",500:"font-medium",600:"font-semibold",700:"font-bold",800:"font-extrabold",900:"font-black"}[e]||null)};return Object.entries(t).forEach(([e,t])=>{Object.entries(t).forEach(([e,t])=>{const o=a[e];if(o){const e=o(t);e&&!r.includes(e)&&r.push(e)}})}),r.join(" ")}chrome.runtime.onInstalled.addListener(()=>{console.log("Frontend Toolbox extension installed"),chrome.storage.local.set({toolboxSettings:{autoEnable:!1,defaultTools:["imageDownloader","styleInspector","videoRecorder"],theme:"light"},recordings:[],savedStyles:[]}),chrome.contextMenus.create({id:"frontend-toolbox-parent",title:"Frontend Toolbox",contexts:["all"]}),chrome.contextMenus.create({id:"image-downloader",parentId:"frontend-toolbox-parent",title:"🖼️ 이미지 다운로더",contexts:["all"]}),chrome.contextMenus.create({id:"style-inspector",parentId:"frontend-toolbox-parent",title:"🔍 스타일 검사기",contexts:["all"]}),chrome.contextMenus.create({id:"video-recorder",parentId:"frontend-toolbox-parent",title:"🎥 비디오 녹화기",contexts:["all"]})}),chrome.tabs.onUpdated.addListener((e,t,o)=>{"complete"===t.status&&o.url&&console.log(`Tab updated: ${o.url}`)}),chrome.contextMenus.onClicked.addListener((e,t)=>{if(t?.id)switch(e.menuItemId){case"image-downloader":chrome.tabs.sendMessage(t.id,{action:"openImageDownloader"});break;case"style-inspector":chrome.tabs.sendMessage(t.id,{action:"openStyleInspector"});break;case"video-recorder":chrome.tabs.sendMessage(t.id,{action:"openVideoRecorder"})}}),chrome.runtime.onMessage.addListener((r,a,n)=>{switch(r.action){case"getSettings":return chrome.storage.local.get(["toolboxSettings"],e=>{n(e.toolboxSettings||{})}),!0;case"saveSettings":return chrome.storage.local.set({toolboxSettings:r.settings},()=>{n({success:!0})}),!0;case"getImages":return a.tab?.id?chrome.tabs.sendMessage(a.tab.id,{action:"collectImages"},e=>{n(e||{images:[]})}):n({images:[]}),!0;case"downloadImage":return r.data?.image?chrome.downloads.download({url:r.data.image.src||r.data.image.url,filename:e(r.data.image),conflictAction:"uniquify"},e=>{chrome.runtime.lastError?(console.error("Download error:",chrome.runtime.lastError),n({error:chrome.runtime.lastError.message})):n({success:!0,downloadId:e})}):n({error:"No image data provided"}),!0;case"downloadImages":return r.data?.images?function(t,o){let r=0,a=0;const n=t.length;0!==n?t.forEach((t,s)=>{setTimeout(()=>{chrome.downloads.download({url:t.src||t.url,filename:e(t),conflictAction:"uniquify"},e=>{chrome.runtime.lastError||!e?a++:r++,r+a===n&&o({success:!0,downloaded:r,errors:a,total:n})})},200*s)}):o({success:!0,downloaded:0,errors:0})}(r.data.images,n):n({error:"No images data provided"}),!0;case"download":return chrome.downloads.download({url:r.url,filename:r.filename,conflictAction:"uniquify"},e=>{chrome.runtime.lastError?(console.error("Download error:",chrome.runtime.lastError),n({error:chrome.runtime.lastError.message})):n(e?{success:!0,downloadId:e}:{error:"Download failed"})}),!0;case"startStyleInspector":return a.tab?.id?chrome.tabs.sendMessage(a.tab.id,{action:"activateStyleInspector"},e=>{n(e||{success:!0})}):n({error:"No active tab"}),!0;case"stopStyleInspector":return a.tab?.id?chrome.tabs.sendMessage(a.tab.id,{action:"deactivateStyleInspector"},e=>{n(e||{success:!0})}):n({error:"No active tab"}),!0;case"styleExtracted":return console.log("Style extracted:",r.data),chrome.storage.local.get("savedStyles",e=>{const s=e.savedStyles||[],c={id:Date.now().toString(),timestamp:(new Date).toISOString(),selector:r.data.selector,properties:r.data.properties,css:t(r.data),tailwind:o(r.data)};s.push(c),chrome.storage.local.set({savedStyles:s},()=>{n({success:!0,savedStyle:c}),a.tab?.id&&chrome.tabs.sendMessage(a.tab.id,{action:"stylesSaved",data:{savedStyles:s,newStyle:c}})})}),!0;case"recordingStarted":console.log("Recording started:",r.data),n({success:!0});break;case"recordingCompleted":console.log("Recording completed:",r.data),n({success:!0});break;case"startVideoRecording":n({error:"비디오 녹화는 웹페이지에서 직접 권한을 요청해야 합니다. getDisplayMedia API를 사용하세요."});break;case"stopVideoRecording":n({error:"비디오 녹화 중지는 content script에서 처리됩니다."});break;case"downloadRecording":r.data?.recording?n({success:!0}):n({error:"No recording data provided"});break;case"deleteRecording":n({success:!0});break;default:n({error:"Unknown action"})}})})();