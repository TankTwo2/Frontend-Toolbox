(()=>{"use strict";function e(e){if("svg"===e.type)return`${e.alt||"svg-image"}.svg`;if(e.src&&e.src.startsWith("blob:"))return`${e.alt||"image"}.${"background"===e.type?"jpg":"png"}`;try{let t=new URL(e.src||e.url).pathname.split("/").pop()||"image";if(!t.includes(".")){let r=function(e){if(!e)return null;const t=e.match(/\.(jpg|jpeg|png|gif|svg|webp|bmp)(\?|$)/i);return t?t[1].toLowerCase():null}(e.src||e.url);return r||(r="background"===e.type?"jpg":"png"),`${t}.${r}`}return t}catch{return`${e.alt||"image"}.${"background"===e.type?"jpg":"png"}`}}function t(e){const{properties:t,selector:r}=e;let o=`${r} {\n`;const a=["display","position","width","height","color","background-color","font-size","font-family"];return a.forEach(e=>{Object.entries(t).forEach(([t,r])=>{r[e]&&(o+=`  ${e}: ${r[e]};\n`)})}),Object.entries(t).forEach(([e,t])=>{Object.entries(t).forEach(([e,t])=>{!a.includes(e)&&t&&"initial"!==t&&"normal"!==t&&(o+=`  ${e}: ${t};\n`)})}),o+="}",o}function r(e){const{properties:t,tailwindClasses:r}=e,o=[...r||[]],a={display:e=>({block:"block",inline:"inline","inline-block":"inline-block",flex:"flex","inline-flex":"inline-flex",grid:"grid",hidden:"hidden"}[e]||null),"text-align":e=>({left:"text-left",center:"text-center",right:"text-right",justify:"text-justify"}[e]||null),"font-weight":e=>({100:"font-thin",200:"font-extralight",300:"font-light",400:"font-normal",500:"font-medium",600:"font-semibold",700:"font-bold",800:"font-extrabold",900:"font-black"}[e]||null)};return Object.entries(t).forEach(([e,t])=>{Object.entries(t).forEach(([e,t])=>{const r=a[e];if(r){const e=r(t);e&&!o.includes(e)&&o.push(e)}})}),o.join(" ")}chrome.runtime.onInstalled.addListener(()=>{chrome.storage.local.set({toolboxSettings:{autoEnable:!1,defaultTools:["imageDownloader","styleInspector","videoRecorder"],theme:"light"},recordings:[],savedStyles:[]}),chrome.contextMenus.create({id:"frontend-toolbox-parent",title:"Frontend Toolbox",contexts:["all"]}),chrome.contextMenus.create({id:"image-downloader",parentId:"frontend-toolbox-parent",title:"🖼️ 이미지 다운로더",contexts:["all"]}),chrome.contextMenus.create({id:"style-inspector",parentId:"frontend-toolbox-parent",title:"🔍 스타일 검사기",contexts:["all"]}),chrome.contextMenus.create({id:"video-recorder",parentId:"frontend-toolbox-parent",title:"🎥 비디오 녹화기",contexts:["all"]})}),chrome.tabs.onUpdated.addListener((e,t,r)=>{}),chrome.contextMenus.onClicked.addListener((e,t)=>{if(t?.id)switch(e.menuItemId){case"image-downloader":chrome.tabs.sendMessage(t.id,{action:"openImageDownloader"});break;case"style-inspector":chrome.tabs.sendMessage(t.id,{action:"openStyleInspector"});break;case"video-recorder":chrome.tabs.sendMessage(t.id,{action:"openVideoRecorder"})}}),chrome.runtime.onMessage.addListener((o,a,n)=>{switch(o.action){case"getSettings":return chrome.storage.local.get(["toolboxSettings"],e=>{n(e.toolboxSettings||{})}),!0;case"saveSettings":return chrome.storage.local.set({toolboxSettings:o.settings},()=>{n({success:!0})}),!0;case"getImages":return a.tab?.id?chrome.tabs.sendMessage(a.tab.id,{action:"collectImages"},e=>{n(e||{images:[]})}):n({images:[]}),!0;case"downloadImage":return o.data?.image?chrome.downloads.download({url:o.data.image.src||o.data.image.url,filename:e(o.data.image),conflictAction:"uniquify"},e=>{chrome.runtime.lastError?(console.error("Download error:",chrome.runtime.lastError),n({error:chrome.runtime.lastError.message})):n({success:!0,downloadId:e})}):n({error:"No image data provided"}),!0;case"downloadImages":return o.data?.images?function(t,r){let o=0,a=0;const n=t.length;0!==n?t.forEach((t,s)=>{setTimeout(()=>{chrome.downloads.download({url:t.src||t.url,filename:e(t),conflictAction:"uniquify"},e=>{chrome.runtime.lastError||!e?a++:o++,o+a===n&&r({success:!0,downloaded:o,errors:a,total:n})})},200*s)}):r({success:!0,downloaded:0,errors:0})}(o.data.images,n):n({error:"No images data provided"}),!0;case"download":return chrome.downloads.download({url:o.url,filename:o.filename,conflictAction:"uniquify"},e=>{chrome.runtime.lastError?(console.error("Download error:",chrome.runtime.lastError),n({error:chrome.runtime.lastError.message})):n(e?{success:!0,downloadId:e}:{error:"Download failed"})}),!0;case"startStyleInspector":return a.tab?.id?chrome.tabs.sendMessage(a.tab.id,{action:"activateStyleInspector"},e=>{n(e||{success:!0})}):n({error:"No active tab"}),!0;case"stopStyleInspector":return a.tab?.id?chrome.tabs.sendMessage(a.tab.id,{action:"deactivateStyleInspector"},e=>{n(e||{success:!0})}):n({error:"No active tab"}),!0;case"styleExtracted":return chrome.storage.local.get("savedStyles",e=>{const s=e.savedStyles||[],c={id:Date.now().toString(),timestamp:(new Date).toISOString(),selector:o.data.selector,properties:o.data.properties,css:t(o.data),tailwind:r(o.data)};s.push(c),chrome.storage.local.set({savedStyles:s},()=>{n({success:!0,savedStyle:c}),a.tab?.id&&chrome.tabs.sendMessage(a.tab.id,{action:"stylesSaved",data:{savedStyles:s,newStyle:c}})})}),!0;case"recordingStarted":case"recordingCompleted":case"deleteRecording":n({success:!0});break;case"startVideoRecording":if("tab"===o.data?.videoType&&a.tab?.id){const e={audio:o.data.audio||!1,video:!0};chrome.tabCapture.capture(e,e=>{chrome.runtime.lastError?n({error:`탭 캡처 실패: ${chrome.runtime.lastError.message}`}):n(e?{success:!0,streamId:e.id}:{error:"탭 스트림을 생성할 수 없습니다."})})}else n({error:"화면/영역 녹화는 content script에서 getDisplayMedia를 사용하세요."});return!0;case"stopVideoRecording":n({error:"비디오 녹화 중지는 content script에서 처리됩니다."});break;case"downloadRecording":o.data?.recording?n({success:!0}):n({error:"No recording data provided"});break;default:n({error:"Unknown action"})}})})();